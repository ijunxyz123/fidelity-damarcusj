<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="fidelity">
<title>Calculating animal site fidelity in R with package `fidelity` • fidelity</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculating animal site fidelity in R with package `fidelity`">
<meta property="og:description" content="fidelity">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fidelity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/fidelity_vignette1.html">Calculating animal site fidelity in R with package `fidelity`</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Calculating animal site fidelity in R with package `fidelity`</h1>
                        <h4 data-toc-skip class="author">Simona
Picardi</h4>
            
            <h4 data-toc-skip class="date">December 2022</h4>
      
      
      <div class="d-none name"><code>fidelity_vignette1.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">fidelity</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>fidelity</code> package provides functions to calculate
animal site fidelity at multiple spatio-temporal scales by contrasting
observed patterns of return to ecologically meaningful baseline
expectations derived from null, memory-free movement models. This
package is for you if:</p>
<ul>
<li>You are interested in exploring the effect of movement parameters
and landscape characteristics on patterns of return using agent-based
simulation;</li>
<li>You are interested in establishing an ecologically meaningful null
expectation for site fidelity in your study system.</li>
</ul>
<p>For more context, please refer to the associated paper:</p>
<blockquote>
<p>Picardi, S., Abrahms, B., Gelzer, E., Morrison, T., Verzuh, T.,
Merkle, J. “Defining null expectations for animal site fidelity”.
Ecology Letters (2022). <a href="https://doi.org/10.1111/ele.14148" class="external-link uri">https://doi.org/10.1111/ele.14148</a></p>
</blockquote>
<p>Depending on which goal you are after, you will follow one of two
possible workflows, illustrated in this diagram:</p>
<p><img src="../../../../Box%20Sync/Programming/fidelity/articles/flowchart.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="goal-1-explore-effect-of-movement-and-landscape-characteristics-on-patterns-of-return">Goal 1: Explore effect of movement and landscape characteristics on
patterns of return<a class="anchor" aria-label="anchor" href="#goal-1-explore-effect-of-movement-and-landscape-characteristics-on-patterns-of-return"></a>
</h2>
<p>If our goal is to quantify how emerging patterns of return vary as a
function of the underlying movement and landscape characteristics, we
can use an agent-based simulation approach to generate movement tracks
under a set of chosen movement models. This package implements movement
models from the family of random walks. Within each model, we can define
a set of scenarios that correspond to different sets of model parameter
values.</p>
<div class="section level3">
<h3 id="parameterize-simulation-scenarios">Parameterize simulation scenarios<a class="anchor" aria-label="anchor" href="#parameterize-simulation-scenarios"></a>
</h3>
<p>The simplest model implemented in <code>fidelity</code> is a
correlated random walk (CRW). Under this model, we can change the value
of the parameter <span class="math inline">\(\rho\)</span> (the movement
autocorrelation, or directional persistence). When <span class="math inline">\(\rho = 0\)</span>, the model is a completely
random walk, where each angle is independent of the previous one. As the
value of <span class="math inline">\(\rho\)</span> increases,
consecutive angles become increasingly correlated. We would expect a
higher movement autocorrelation to result in fewer returns than a lower
one. Let’s use the function <code><a href="../reference/create_scenarios_crw.html">create_scenarios_crw()</a></code> to
parameterize three CRW scenarios:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scen_crw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_scenarios_crw.html">create_scenarios_crw</a></span><span class="op">(</span>rho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating 3 CRW scenarios</span></span></code></pre></div>
<p>The first scenario is a completely random walk, the second scenario
is a correlated random walk with intermediate movement autocorrelation,
and the third scenario is an almost perfectly correlated random
walk.</p>
<p>As of now, three more movement models are implemented in
<code>fidelity</code> besides a CRW: a constrained correlated random
walk (CCRW), where an agent moves within a non-permeable reflective
boundary that represents an enclosure; a mixture correlated random walk
(MCRW), where an agent moves faster and straighter through unprofitable
habitat and slower and more tortuously through profitable habitat; and a
biased correlated random walk (BCRW), where an agent is attracted to
profitable habitat in its surroundings. Unlike the first two, these last
two models require that the agent moves on a landscape with
heterogeneous habitat quality. Let’s use BCRW as an example of how to
parameterize this type of model.</p>
<p>To parameterize a BCRW scenario, we must start by creating one or
more synthetic landscapes for the agent to move through. We can create
landscapes in <code>fidelity</code> using the function
<code><a href="../reference/sim_land.html">sim_land()</a></code>. Here, assuming meters as the units, I am
creating a set of landscapes with a resolution of 10 m and a 1-km
extent. I am defining the center point of the landscape at coordinates
(0, 0). The parameter <span class="math inline">\(\kappa\)</span>
indicates spatial aggregation, or how “clumpy” the habitat is. Let’s
create two landscapes with different amounts of spatial aggregation (50
and 500). The parameter <span class="math inline">\(\chi\)</span>
indicates spatial heterogeneity, or how much habitat quality varies
across the landscape. Here, we’ll hold that constant for both
landscapes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lands</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_land.html">sim_land</a></span><span class="op">(</span>res <span class="op">=</span> <span class="fl">10</span>, ext <span class="op">=</span> <span class="fl">1000</span>, orig <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">"y"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, kappa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">500</span><span class="op">)</span>, chi <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p>This is what the resulting landscapes look like:</p>
<p><img src="fidelity_vignette1_files/figure-html/load%20landscapes-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The simulation functions we’ll use will need to read the landscape
rasters from disk, so let’s go ahead and save them as files:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">lands</span>, </span>
<span>                    filename <span class="op">=</span> <span class="st">"inst/Landscapes/land.tif"</span>, </span>
<span>                    bylayer <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                    suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lands</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And it’s important to assign names to each raster to match the path
we’re going to use to load them in (you can use absolute paths or,
better, relative paths with respect to your working directory):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">land_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"inst/Landscapes/land_"</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lands</span><span class="op">)</span>, </span>
<span>                     <span class="st">".tif"</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s define a set of BCRW scenarios. We’ll hold the value of
<span class="math inline">\(\rho\)</span> constant across scenarios. The
parameter <span class="math inline">\(\beta\)</span> is the directional
bias and it indicates how strongly the agent is attracted to
high-quality habitat. We’ll create a scenario with no bias at all (note
that, without bias, this is the same exact scenario as the second CRW
scenario we parameterized above), a scenario with low bias, and a
scenario with moderate bias. The higher the bias, the more likely we
expect returns to occur. We want each of these sets of movement
parameter in combination with each of the landscapes we have generated,
for a total of 1 * 3 * 2 = 6 scenarios:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scen_bcrw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_scenarios_bcrw.html">create_scenarios_bcrw</a></span><span class="op">(</span>rho <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                   beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                                   lands <span class="op">=</span> <span class="va">land_names</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating 6 BCRW scenarios</span></span></code></pre></div>
<p>Now we can <code>rbind</code> all the scenarios together into a
single data frame:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">scen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">scen_crw</span>, <span class="va">scen_bcrw</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    rho boundary_size habitat_effect beta</span></span>
<span><span class="co">#&gt; 1 0.00            NA             NA   NA</span></span>
<span><span class="co">#&gt; 2 0.50            NA             NA   NA</span></span>
<span><span class="co">#&gt; 3 0.99            NA             NA   NA</span></span>
<span><span class="co">#&gt; 4 0.50            NA             NA  0.0</span></span>
<span><span class="co">#&gt; 5 0.50            NA             NA  0.1</span></span>
<span><span class="co">#&gt; 6 0.50            NA             NA  0.5</span></span>
<span><span class="co">#&gt; 7 0.50            NA             NA  0.0</span></span>
<span><span class="co">#&gt; 8 0.50            NA             NA  0.1</span></span>
<span><span class="co">#&gt; 9 0.50            NA             NA  0.5</span></span>
<span><span class="co">#&gt;                                        lands kappa chi scenario_id</span></span>
<span><span class="co">#&gt; 1                                       &lt;NA&gt;    NA  NA       CRW_1</span></span>
<span><span class="co">#&gt; 2                                       &lt;NA&gt;    NA  NA       CRW_2</span></span>
<span><span class="co">#&gt; 3                                       &lt;NA&gt;    NA  NA       CRW_3</span></span>
<span><span class="co">#&gt; 4  inst/Landscapes/land_kappa_50_chi_0.5.tif    50 0.5      BCRW_1</span></span>
<span><span class="co">#&gt; 5  inst/Landscapes/land_kappa_50_chi_0.5.tif   500 0.5      BCRW_2</span></span>
<span><span class="co">#&gt; 6  inst/Landscapes/land_kappa_50_chi_0.5.tif    50 0.5      BCRW_3</span></span>
<span><span class="co">#&gt; 7 inst/Landscapes/land_kappa_500_chi_0.5.tif   500 0.5      BCRW_4</span></span>
<span><span class="co">#&gt; 8 inst/Landscapes/land_kappa_500_chi_0.5.tif    50 0.5      BCRW_5</span></span>
<span><span class="co">#&gt; 9 inst/Landscapes/land_kappa_500_chi_0.5.tif   500 0.5      BCRW_6</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulate-movement-paths">Simulate movement paths<a class="anchor" aria-label="anchor" href="#simulate-movement-paths"></a>
</h3>
<p>Once we have defined our simulation scenarios, it’s time to simulate
movement paths. To run a BCRW, we will need to specify a value of
perceptual range, i.e., how far away can the agent perceive a
high-quality patch and direct its movements towards it. This parameter
should be set to a biologically reasonable value, and of course it is
also interesting to see how results are affected by it. Here, we’ll set
the perceptual range to 50 m:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prange</span> <span class="op">&lt;-</span> <span class="fl">50</span></span></code></pre></div>
<p>The BCRW simulation function will also require a map of pixel
neighborhoods. These maps are specific to the landscape extent and
resolution, so they will need to be re-calculated for new landscapes. In
our case, the two landscapes have the same extent and resolution (only
the value of <span class="math inline">\(\kappa\)</span> varies between
them), so we can calculate the neighborhoods just once using one of the
two landscapes as the template. We can use the function
<code><a href="../reference/get_neighbors.html">get_neighbors()</a></code> and pass it our chosen value of perceptual
range:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">neigh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_neighbors.html">get_neighbors</a></span><span class="op">(</span><span class="va">lands</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, prange <span class="op">=</span> <span class="va">prange</span><span class="op">)</span></span></code></pre></div>
<p>We are finally ready to simulate! The function
<code><a href="../reference/simulate_tracks.html">simulate_tracks()</a></code> is a wrapper function that will call the
appropriate model-specific simulation function depending on how each
scenario is parameterized, so we can run simulations on different types
of models all at once. We’ll need to define how many steps each
simulation should run for (here, let’s use 100), how many replicates
should be run (if we wanted to make some robust conclusions we would
need a large number of replicates, but for simplicity, let’s just do 1
here), the coordinates of the starting location for each simulation
(these can be jittered by setting <code>jitter = TRUE</code>), and the
shape and scale of the step length distribution (assuming a Weibull
distribution). The remaining arguments are used to pass to the function
our scenario data frame, the value of perceptual range, and the
neighborhood map:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_tracks.html">simulate_tracks</a></span><span class="op">(</span>scenarios <span class="op">=</span> <span class="va">scen</span>,</span>
<span>                       n_steps <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                       n_tracks <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                       start_loc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                       sl_par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>                       prange <span class="op">=</span> <span class="va">prange</span>,</span>
<span>                       jitter <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                       neighbors <span class="op">=</span> <span class="va">neigh</span><span class="op">)</span></span></code></pre></div>
<p>This is what the output of the simulation will look like:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id          x          y step rho boundary_size habitat_effect beta landscape</span></span>
<span><span class="co">#&gt; 1  1   0.000000   0.000000    0   0            NA             NA   NA      &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2  1 -14.945691 -21.910068    1   0            NA             NA   NA      &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3  1   4.800396 -20.926486    2   0            NA             NA   NA      &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4  1   2.837701  -9.958197    3   0            NA             NA   NA      &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5  1   2.585969  -8.049080    4   0            NA             NA   NA      &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6  1  28.997396 -26.154277    5   0            NA             NA   NA      &lt;NA&gt;</span></span>
<span><span class="co">#&gt;   scenario_id</span></span>
<span><span class="co">#&gt; 1       CRW_1</span></span>
<span><span class="co">#&gt; 2       CRW_1</span></span>
<span><span class="co">#&gt; 3       CRW_1</span></span>
<span><span class="co">#&gt; 4       CRW_1</span></span>
<span><span class="co">#&gt; 5       CRW_1</span></span>
<span><span class="co">#&gt; 6       CRW_1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="co">#&gt;     id         x         y step rho boundary_size habitat_effect beta</span></span>
<span><span class="co">#&gt; 886  1 -239.7802 -338.2598   95 0.5            NA             NA  0.5</span></span>
<span><span class="co">#&gt; 887  1 -227.3308 -403.2010   96 0.5            NA             NA  0.5</span></span>
<span><span class="co">#&gt; 888  1 -236.5789 -417.1284   97 0.5            NA             NA  0.5</span></span>
<span><span class="co">#&gt; 889  1 -235.3682 -412.1410   98 0.5            NA             NA  0.5</span></span>
<span><span class="co">#&gt; 890  1 -222.6736 -405.9211   99 0.5            NA             NA  0.5</span></span>
<span><span class="co">#&gt; 891  1 -212.5907 -414.7889  100 0.5            NA             NA  0.5</span></span>
<span><span class="co">#&gt;                                               landscape scenario_id</span></span>
<span><span class="co">#&gt; 886 fidelity/inst/Landscapes/land_kappa_500_chi_0.5.tif      BCRW_6</span></span>
<span><span class="co">#&gt; 887 fidelity/inst/Landscapes/land_kappa_500_chi_0.5.tif      BCRW_6</span></span>
<span><span class="co">#&gt; 888 fidelity/inst/Landscapes/land_kappa_500_chi_0.5.tif      BCRW_6</span></span>
<span><span class="co">#&gt; 889 fidelity/inst/Landscapes/land_kappa_500_chi_0.5.tif      BCRW_6</span></span>
<span><span class="co">#&gt; 890 fidelity/inst/Landscapes/land_kappa_500_chi_0.5.tif      BCRW_6</span></span>
<span><span class="co">#&gt; 891 fidelity/inst/Landscapes/land_kappa_500_chi_0.5.tif      BCRW_6</span></span></code></pre></div>
<p>Let’s take a look at the path we simulated under scenario
<code>CRW_1</code> (a completely random walk):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span><span class="op">[</span><span class="va">sim</span><span class="op">$</span><span class="va">scenario_id</span> <span class="op">==</span> <span class="st">"CRW_1"</span> <span class="op">&amp;</span> <span class="va">sim</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span><span class="op">$</span><span class="va">x</span>, </span>
<span>     <span class="va">sim</span><span class="op">[</span><span class="va">sim</span><span class="op">$</span><span class="va">scenario_id</span> <span class="op">==</span> <span class="st">"CRW_1"</span> <span class="op">&amp;</span> <span class="va">sim</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span><span class="op">$</span><span class="va">y</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"x"</span>, ylab <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/plot%20crw-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Then, let’s take a look at the path we simulated under scenario
<code>BCRW_2</code> (a BCRW with low bias in a landscape with low
aggregation):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lands</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">sim</span><span class="op">[</span><span class="va">sim</span><span class="op">$</span><span class="va">scenario_id</span> <span class="op">==</span> <span class="st">"BCRW_2"</span>, <span class="op">]</span><span class="op">$</span><span class="va">x</span>, </span>
<span>      <span class="va">sim</span><span class="op">[</span><span class="va">sim</span><span class="op">$</span><span class="va">scenario_id</span> <span class="op">==</span> <span class="st">"BCRW_2"</span>, <span class="op">]</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/plot%20bcrw1-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Finally, let’s take a look at the path we simulated under scenario
<code>BCRW_5</code> (a BCRW with low bias in a landscape with high
aggregation):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lands</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">sim</span><span class="op">[</span><span class="va">sim</span><span class="op">$</span><span class="va">scenario_id</span> <span class="op">==</span> <span class="st">"BCRW_5"</span>, <span class="op">]</span><span class="op">$</span><span class="va">x</span>, </span>
<span>      <span class="va">sim</span><span class="op">[</span><span class="va">sim</span><span class="op">$</span><span class="va">scenario_id</span> <span class="op">==</span> <span class="st">"BCRW_5"</span>, <span class="op">]</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/plot%20bcrw2-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Notice that, in this scenario, the agent ends up reaching the edge of
the landscape. In this case, the simulation is interrupted and the
remainder of the steps are censored. This is why that specific scenario
has only 83 rows instead of 101:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sim</span><span class="op">[</span><span class="va">sim</span><span class="op">$</span><span class="va">scenario_id</span> <span class="op">==</span> <span class="st">"BCRW_1"</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 101</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sim</span><span class="op">[</span><span class="va">sim</span><span class="op">$</span><span class="va">scenario_id</span> <span class="op">==</span> <span class="st">"BCRW_2"</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 101</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sim</span><span class="op">[</span><span class="va">sim</span><span class="op">$</span><span class="va">scenario_id</span> <span class="op">==</span> <span class="st">"BCRW_3"</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 101</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sim</span><span class="op">[</span><span class="va">sim</span><span class="op">$</span><span class="va">scenario_id</span> <span class="op">==</span> <span class="st">"BCRW_4"</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 101</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sim</span><span class="op">[</span><span class="va">sim</span><span class="op">$</span><span class="va">scenario_id</span> <span class="op">==</span> <span class="st">"BCRW_5"</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 83</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sim</span><span class="op">[</span><span class="va">sim</span><span class="op">$</span><span class="va">scenario_id</span> <span class="op">==</span> <span class="st">"BCRW_6"</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 101</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculate-patterns-of-return-on-simulated-paths">Calculate patterns of return on simulated paths<a class="anchor" aria-label="anchor" href="#calculate-patterns-of-return-on-simulated-paths"></a>
</h3>
<p>Now that we have a set of simulated paths, we can calculate patterns
of returns under each scenario. To make sure we only count returns
within each scenario replicate, let’s split the simulation results into
a list based on the scenario ID and agent ID:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">sim</span>, f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">id</span>, <span class="va">sim</span><span class="op">$</span><span class="va">scenario_id</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The function <code><a href="../reference/calc_returns.html">calc_returns()</a></code> assigns a 1 to steps that
satisfy a custom definition of what a return is and a 0 to steps that do
not. The definition can be customized in space using the argument
<code>dist</code> – how close to a previously visited location does the
agent need to go for us to consider that a return? And it can be
customized in time using the argument <code>lag</code> – how long must
the agent have been a distance <code>dist</code> away from that location
before we count a new visit as a return rather than just residence?
Here, we’ll set <code>dist</code> to 10 meters and <code>lag</code> to
10 steps:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sim_list</span><span class="op">)</span>,</span>
<span>                      FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>                        <span class="fu">fidelity</span><span class="fu">::</span><span class="fu"><a href="../reference/calc_returns.html">calc_returns</a></span><span class="op">(</span></span>
<span>                          tracks <span class="op">=</span> <span class="va">sim_list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                          dist <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                          lag <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>                      <span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rets</span>, <span class="fl">15</span><span class="op">)</span></span>
<span><span class="co">#&gt;    id          x            y step rho boundary_size habitat_effect beta</span></span>
<span><span class="co">#&gt; 1   1   0.000000    0.0000000    0 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt; 2   1   1.167169   -0.9063084    1 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt; 3   1   6.644097   -2.6846214    2 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt; 4   1   7.030207   -3.0187556    3 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt; 5   1  21.198206    9.0795829    4 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt; 6   1  53.400107  -22.0152171    5 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt; 7   1  68.115971  -37.2992881    6 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt; 8   1  74.518235  -47.8817753    7 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt; 9   1  75.307828  -65.9028509    8 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt; 10  1  95.911165  -72.2624229    9 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt; 11  1  57.427406 -114.5317217   10 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt; 12  1  73.925033 -140.7330638   11 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt; 13  1 113.682533 -138.3237969   12 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt; 14  1 122.176538 -134.0113648   13 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt; 15  1 131.247000 -133.4714379   14 0.5            NA             NA    0</span></span>
<span><span class="co">#&gt;                                             landscape scenario_id lag_10</span></span>
<span><span class="co">#&gt; 1  fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1     NA</span></span>
<span><span class="co">#&gt; 2  fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1     NA</span></span>
<span><span class="co">#&gt; 3  fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1     NA</span></span>
<span><span class="co">#&gt; 4  fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1     NA</span></span>
<span><span class="co">#&gt; 5  fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1     NA</span></span>
<span><span class="co">#&gt; 6  fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1     NA</span></span>
<span><span class="co">#&gt; 7  fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1     NA</span></span>
<span><span class="co">#&gt; 8  fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1     NA</span></span>
<span><span class="co">#&gt; 9  fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1     NA</span></span>
<span><span class="co">#&gt; 10 fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1     NA</span></span>
<span><span class="co">#&gt; 11 fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1     NA</span></span>
<span><span class="co">#&gt; 12 fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1      0</span></span>
<span><span class="co">#&gt; 13 fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1      0</span></span>
<span><span class="co">#&gt; 14 fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1      0</span></span>
<span><span class="co">#&gt; 15 fidelity/inst/Landscapes/land_kappa_50_chi_0.5.tif      BCRW_1      0</span></span></code></pre></div>
<p>For each of the lags we specify (in this case, just one), the
function will add a column to our simulation data frame: the value will
be <code>NA</code> for steps that are ineligible to count as returns (in
this case, the first 10), 0 for steps that are not returns, and 1 for
steps that satisfy our definition of returns. In this case, none of the
first 4 steps after our 10-step lag happened to be returns.</p>
<p>Besides knowing whether a return happened or not, we may also be
interested in quantifying the spatial intensity of returns. This metric
is useful because it can help us discriminate between returns that
happen by chance (when few returns are spread among many locations)
versus returns that are driven by more systematic drivers (when many
returns are concentrated among few locations). The function
<code><a href="../reference/calc_spint.html">calc_spint()</a></code> calculates the spatial intensity of returns
under each of our simulation scenarios:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spint</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_spint.html">calc_spint</a></span><span class="op">(</span>rets <span class="op">=</span> <span class="va">rets</span>, dist <span class="op">=</span> <span class="fl">10</span>, lag <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="evaluate-effect-of-simulation-parameters-on-patterns-of-return">Evaluate effect of simulation parameters on patterns of return<a class="anchor" aria-label="anchor" href="#evaluate-effect-of-simulation-parameters-on-patterns-of-return"></a>
</h3>
<p>Now we can take a look at how the parameter values we used in our
scenarios affect the occurrence of returns as well as their spatial
intensity. Let’s look at the CRW model first:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rets</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"BCRW"</span>, <span class="va">scenario_id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">step</span>, y <span class="op">=</span> <span class="va">lag_10</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">lag_10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">rho</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time step"</span>, y <span class="op">=</span> <span class="st">"Return"</span>, color <span class="op">=</span> <span class="st">"Return"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 33 rows containing missing values (geom_point).</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/rho-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">spint</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"BCRW"</span>, <span class="va">scenario_id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">scenario_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean_spint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vals</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">scenario_id</span>, y <span class="op">=</span> <span class="va">mean_spint</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Scenario"</span>, y <span class="op">=</span> <span class="st">"Spatial intensity of returns"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/rho-2.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"BCRW"</span>, <span class="va">scenario_id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">rho</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/crw%20paths-1.png" width="576" style="display: block; margin: auto;"></p>
<p>These plots show that, the higher the movement autocorrelation, the
less frequent returns become. There are only two values of spatial
intensity because no returns at all occurred under the third scenario,
and, based on one track only, we cannot detect a difference here (more
replicates would have probably helped). When looking at the tracks, it
is evident that movements become much more directed as the movement
autocorrelation increases.</p>
<p>Now let’s look at our BCRW scenarios. Let’s start with those that we
simulated over a landscape with low spatial aggregation:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rets</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scenario_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BCRW_1"</span>, <span class="st">"BCRW_2"</span>, <span class="st">"BCRW_3"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">step</span>, y <span class="op">=</span> <span class="va">lag_10</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">lag_10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">beta</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time step"</span>, y <span class="op">=</span> <span class="st">"Return"</span>, color <span class="op">=</span> <span class="st">"Return"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 33 rows containing missing values (geom_point).</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/beta%20kappa50-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">spint</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scenario_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BCRW_1"</span>, <span class="st">"BCRW_2"</span>, <span class="st">"BCRW_3"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">scenario_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean_spint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vals</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">scenario_id</span>, y <span class="op">=</span> <span class="va">mean_spint</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Scenario"</span>, y <span class="op">=</span> <span class="st">"Spatial intensity of returns"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/beta%20kappa50-2.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scenario_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BCRW_1"</span>, <span class="st">"BCRW_2"</span>, <span class="st">"BCRW_3"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">beta</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/bcrw%20paths%201-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Here, we can see that returns become more frequent as the bias
towards profitable habitat increases. Spatial intensity is higher in the
scenarios with bias compared to the scenario with no bias. When looking
at the paths, notice the agent moving much more tortuously in the
scenario with strongest bias because it encountered a profitable
patch.</p>
<p>What happens when patches are much larger and high-quality habitat is
more aggregated?</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rets</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scenario_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BCRW_4"</span>, <span class="st">"BCRW_5"</span>, <span class="st">"BCRW_6"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">step</span>, y <span class="op">=</span> <span class="va">lag_10</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">lag_10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">beta</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time step"</span>, y <span class="op">=</span> <span class="st">"Return"</span>, color <span class="op">=</span> <span class="st">"Return"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 33 rows containing missing values (geom_point).</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/beta%20kappa500-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">spint</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scenario_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BCRW_4"</span>, <span class="st">"BCRW_5"</span>, <span class="st">"BCRW_6"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">scenario_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean_spint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vals</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">scenario_id</span>, y <span class="op">=</span> <span class="va">mean_spint</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Scenario"</span>, y <span class="op">=</span> <span class="st">"Spatial intensity of returns"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/beta%20kappa500-2.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scenario_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BCRW_4"</span>, <span class="st">"BCRW_5"</span>, <span class="st">"BCRW_6"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">beta</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/bcrw%20paths%202-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Similarly, the stronger the bias, the more frequent the returns,
although no returns at all happened under the second scenario in this
particular instance (remember that this is the scenario where the agent
happened to move out of the landscape, which means it had a shorter
simulation and fewer chances to return). There are only two values of
spatial intensity because no returns happened under one of the three
scenarios, and we cannot really detect a difference there.</p>
<p>Through this exercise, we have learned some interesting facts about
how simple metrics of behavior and landscape configuration should be
expected to affect patterns of returns in real systems.</p>
</div>
</div>
<div class="section level2">
<h2 id="goal-2-quantify-site-fidelity-by-contrasting-empirical-data-with-an-ecologically-meaningful-null-expectation">Goal 2: Quantify site fidelity by contrasting empirical data with an
ecologically meaningful null expectation<a class="anchor" aria-label="anchor" href="#goal-2-quantify-site-fidelity-by-contrasting-empirical-data-with-an-ecologically-meaningful-null-expectation"></a>
</h2>
<p>If our goal is to quantify site fidelity in an empirical system, we
can use a slightly different workflow. Let’s make an example with the
data from <a href="https://onlinelibrary.wiley.com/doi/10.1111/ele.14148" class="external-link">Picardi et
al. 2022</a> (available at <a href="https://zenodo.org/record/7079984" class="external-link uri">https://zenodo.org/record/7079984</a> – thanks to Dr. Hall
Sawyer for generously sharing these data with us!). These are real
GPS-tracking data for one individual mule deer collected at a 2-hour
resolution during the summer of 2016 in Wyoming:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mule</span><span class="op">)</span></span>
<span><span class="co">#&gt;    id                date      x       y</span></span>
<span><span class="co">#&gt; 1 445 2016-05-17 18:00:00 535031 4792508</span></span>
<span><span class="co">#&gt; 2 445 2016-05-17 20:00:00 534595 4792287</span></span>
<span><span class="co">#&gt; 3 445 2016-05-17 22:00:00 534611 4792390</span></span>
<span><span class="co">#&gt; 4 445 2016-05-18 00:00:00 534558 4792157</span></span>
<span><span class="co">#&gt; 5 445 2016-05-18 02:00:00 532876 4792317</span></span>
<span><span class="co">#&gt; 6 445 2016-05-18 04:00:00 532647 4792231</span></span></code></pre></div>
<p>Rather than simply assuming that any returns we may observe in this
animal’s track must be due to memory, we can contrast the empirically
observed returns with a baseline non-zero expectation derived from an
appropriate null model via simulation.</p>
<div class="section level3">
<h3 id="parameterize-an-appropriate-null-model">Parameterize an appropriate null model<a class="anchor" aria-label="anchor" href="#parameterize-an-appropriate-null-model"></a>
</h3>
<p>Depending on the study objectives, different models can be
appropriately chosen as null models for site fidelity. If the objective
is to quantify whether the empirically observed returns are due to
memory, one should strive to parameterize a null model realistic enough
that it can be argued that all behavioral processes other than memory
(e.g., movement, habitat selection) have been accounted for. If the
observed patterns of returns still exceed what expected based on a model
that accounts for everything but memory, then we can confidently
attribute the excess to memory. In <a href="https://onlinelibrary.wiley.com/doi/10.1111/ele.14148" class="external-link">Picardi et
al. 2022</a>, we used an integrated step selection function as a
hyper-realistic null model that is able to account for the movement
process and the habitat selection process simultaneously. If the
objective is to quantify whether the empirically observed returns are
generally due to systematic drivers rather than just pure chance, then a
simple random walk can be an appropriate null model. Note that, in this
case, no inference can be made on the specific drivers of the
empirically observed returns, be it movement characteristics, habitat
selection, or memory. All we can answer is whether the animal is
returning more than would be expected under a random walk or not. Here,
for simplicity, let’s use a pure random walk as the null model:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">random_scen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_scenarios_crw.html">create_scenarios_crw</a></span><span class="op">(</span>rho <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating 1 CRW scenarios</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulate-movement-paths-1">Simulate movement paths<a class="anchor" aria-label="anchor" href="#simulate-movement-paths-1"></a>
</h3>
<p>Let’s simulate a random walk that starts at the same strating point
and includes as many steps as the empirical mule deer track:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_null</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_tracks.html">simulate_tracks</a></span><span class="op">(</span>scenarios <span class="op">=</span> <span class="va">random_scen</span>,</span>
<span>                       n_steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mule</span><span class="op">)</span>,</span>
<span>                       n_tracks <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                       start_loc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mule</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">mule</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                       sl_par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">330</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The step length parameters specified here were estimated for this
individual mule deer at a 2-hour time resolution via integrated step
selection analysis.</p>
</div>
<div class="section level3">
<h3 id="calculate-patterns-of-return-on-simulated-paths-1">Calculate patterns of return on simulated paths<a class="anchor" aria-label="anchor" href="#calculate-patterns-of-return-on-simulated-paths-1"></a>
</h3>
<p>Let’s now calculate the occurrence and spatial intensity of returns
over the simulated track in output from the null random walk model:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ret_null</span> <span class="op">&lt;-</span> <span class="fu">fidelity</span><span class="fu">::</span><span class="fu"><a href="../reference/calc_returns.html">calc_returns</a></span><span class="op">(</span>tracks <span class="op">=</span> <span class="va">sim_null</span>,</span>
<span>                          dist <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                          lag <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="va">spint_null</span> <span class="op">&lt;-</span> <span class="fu">fidelity</span><span class="fu">::</span><span class="fu"><a href="../reference/calc_spint.html">calc_spint</a></span><span class="op">(</span><span class="va">ret_null</span>, </span>
<span>                                   dist <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                                   lag <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p>Note that we set the value of distance to 50 m, meaning that the
animal needs to be within 50 m of a previously visited location for a
visit to count as a return. We used a lag of 12 * 7 = 84, corresponding
to a week (12 locations per day times 7 days), meaning that the animal
needs to have been away from a location for at least one week for a new
visit to count as a return.</p>
</div>
<div class="section level3">
<h3 id="calculate-patterns-of-return-on-empirically-observed-paths">Calculate patterns of return on empirically observed paths<a class="anchor" aria-label="anchor" href="#calculate-patterns-of-return-on-empirically-observed-paths"></a>
</h3>
<p>Let’s now calculate the occurrence and spatial intensity of returns
over the empirically observed mule deer track:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ret_obs</span> <span class="op">&lt;-</span> <span class="fu">fidelity</span><span class="fu">::</span><span class="fu"><a href="../reference/calc_returns.html">calc_returns</a></span><span class="op">(</span>tracks <span class="op">=</span> <span class="va">mule</span>,</span>
<span>                          dist <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                          lag <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#&gt; Column 'scenario_id' is missing, splitting by 'id' only</span></span>
<span></span>
<span><span class="va">spint_obs</span> <span class="op">&lt;-</span> <span class="fu">fidelity</span><span class="fu">::</span><span class="fu"><a href="../reference/calc_spint_track.html">calc_spint_track</a></span><span class="op">(</span><span class="va">ret_obs</span>, </span>
<span>                                   dist <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                                   lag <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p>Note that, because this is a single track rather than a set of
simulations from different scenarios, I used the function
<code><a href="../reference/calc_spint_track.html">calc_spint_track()</a></code> rather than <code><a href="../reference/calc_spint.html">calc_spint()</a></code>.
<code><a href="../reference/calc_spint.html">calc_spint()</a></code> is just a wrapper that calls
<code><a href="../reference/calc_spint_track.html">calc_spint_track()</a></code> and applies it to a set of scenarios,
but here it would not work to use it because there is no
<code>scenario_id</code> column in the real data. If one wanted to
calculate spatial intensity of returns over multiple empirical tracks at
once, a solution is to simply add a “scenario ID” column to the real
data with a different ID assigned to each track.</p>
</div>
<div class="section level3">
<h3 id="compare">Compare<a class="anchor" aria-label="anchor" href="#compare"></a>
</h3>
<p>Let’s now compare patterns of returns in our empirically observed
track with the null model:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ret_obs</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"Observed"</span></span>
<span><span class="va">ret_null</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"Null"</span></span>
<span><span class="va">ret_null</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ret_obs</span><span class="op">$</span><span class="va">date</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">comp_ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">ret_obs</span>, <span class="va">ret_null</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"date"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"lag_84"</span>, <span class="st">"type"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">comp_ret</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">lag_84</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">lag_84</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">type</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Timestamp"</span>, y <span class="op">=</span> <span class="st">"Return"</span>, color <span class="op">=</span> <span class="st">"Return"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 171 rows containing missing values (geom_point).</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/compare-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">spint_null</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"Null"</span></span>
<span><span class="va">comp_spint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">spint_null</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>scenario_id <span class="op">=</span> <span class="st">"real"</span>,</span>
<span>                               vals <span class="op">=</span> <span class="va">spint_obs</span>,</span>
<span>                               type <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">comp_spint</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean_spint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vals</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">type</span>, y <span class="op">=</span> <span class="va">mean_spint</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Path type"</span>, y <span class="op">=</span> <span class="st">"Spatial intensity of returns"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/compare-2.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">comp_ret</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">type</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="fidelity_vignette1_files/figure-html/compare-3.png" width="576" style="display: block; margin: auto;"></p>
<p>Both the frequency and the spatial intensity of returns are much
higher in the observed track compared to the null, indicating that the
returns observed in the empirical data cannot be explained by chance
alone.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
